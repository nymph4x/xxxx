# 福币排行榜页面 (leaderboard.vue)

## 描述
福币排行榜页面用于展示福币积分排名前 10 的用户列表，显示用户的昵称、头像、福币数量和排名。同时，页面顶部还会突出显示当前用户的福币排名和分数，让用户了解自己的位置及积分。

## 页面结构与功能
1. **排行榜展示**：页面显示福币积分排名前 10 的用户信息，每条记录包括：
   - **排名**：用户在排行榜中的名次。
   - **用户头像**：用户的头像图片，用于提升页面的视觉效果。
   - **用户昵称**：用户的昵称，帮助用户识别自己和其他用户。
   - **福币数量**：显示用户当前拥有的福币数，以直观展示各用户的积分水平。
   
2. **当前用户信息**：
   - **当前用户排名**：单独显示当前用户的排名，方便用户随时了解自己的积分情况。
   - **当前用户福币数量**：单独显示当前用户的福币余额。

## 数据获取与更新
页面通过调用 `getLeaderboard` 云函数来获取排名前 10 的用户数据和当前用户的排名及积分信息。

## 主要逻辑

- 在 `created` 钩子中，页面加载时调用 `fetchLeaderboardData` 方法获取排行榜数据。
- 使用 `v-for` 循环渲染每个用户的排名、头像、昵称和分数。
- 如果用户的头像 URL 无法直接使用 `fileID` 显示，将通过 `getAndUpdateAvatarUrl` 云函数生成一个临时 URL，并将其更新到 `users` 集合中。

## 相关云函数

### getLeaderboard 云函数
该云函数用于从 `leaderboard` 集合中获取排行榜数据，并结合 `users` 集合中的用户头像和昵称，获取福币积分排名前 10 的用户数据及当前用户的排名信息。
- **输入**：
  - `user_id`：当前用户 ID，用于获取当前用户的排名及积分。
- **输出**：
  - `users`：前 10 名用户的列表数据，包含头像、昵称、福币数量和排名信息。
  - `currentUser`：当前用户的排名和福币数量。
- **逻辑**：
  - 从 `leaderboard` 集合中按福币数降序排列并获取前 10 名用户的信息。
  - 查询并计算当前用户的排名及福币数量。
  - 返回前 10 名用户列表和当前用户数据以供页面展示。

### updateUserScore 云函数
用于更新或添加用户的福币分数。

- **逻辑**：
   - 接收 `user_id` 和 `scoreChange` 作为参数。
   - 查找 `leaderboard` 集合中是否存在该用户记录。
     - 如果存在，则更新分数。
     - 如果不存在，则新增记录。
   - 更新分数后返回成功信息。

- **返回数据结构**：
   - `code`：操作状态码。
   - `msg`：操作结果信息。

### getAndUpdateAvatarUrl 云函数
获取并更新用户头像的 URL。（此函数主要是为了个人进行测试，无法获得多个用户信息，所以自己创建信息，从本地上传图片到云存储作为用户头像，获得一个唯一的 `fileID`， 通过此函数将 `fileID`转换为`avatarUrl`，以便在页面上显示出头像。后续可以选择删除）

- **逻辑**：
   - 接收 `user_id` 作为参数，获取 `users` 集合中的用户记录。
   - 检查 `avatarUrl` 是否是 `fileID`（不是完整的 URL）。
     - 如果是 `fileID`，则调用 `uniCloud.getTempFileURL` 生成临时 URL。
     - 将生成的临时 URL 更新到 `avatarUrl` 字段中。
   - 返回更新后的头像 URL。

- **返回数据结构**：
   - `avatarUrl`：用户头像的临时 URL。
   - `code` 和 `msg`：操作状态码和结果信息。

## 页面交互逻辑
- **页面加载时**：页面初始化时调用 `getLeaderboard` 云函数，获取前 10 名用户数据并展示。
- **当前用户高亮**：当前用户信息在页面中突出显示，区别于其他用户。
- **数据实时更新**：当用户福币数量发生变化时，重新获取并更新页面显示的用户排名和积分。

## 注意事项
- **数据完整性**：确保每个用户数据包含头像、昵称、福币数量和排名，以保持排行榜展示的一致性。
- **用户头像加载**：如用户未上传头像，提供默认头像以确保页面视觉完整性。
- **实时数据刷新**：当用户在其他页面获得福币时，页面应刷新排行榜和当前用户的排名信息，以保证数据同步。

## 小结
福币排行榜页面的主要功能是展示当前用户和前 10 名用户的福币排名信息。通过云函数获取排行榜数据并显示，用户可以实时查看自己的积分排名及积分情况，从而激励用户参与更多的任务活动。
